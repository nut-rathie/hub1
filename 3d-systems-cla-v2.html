<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Systems CLA Diagram v2</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { box-sizing: border-box; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useRef } = React;

    const SystemsCLADiagram = () => {
      const [rotateX, setRotateX] = useState(-20);
      const [rotateY, setRotateY] = useState(-25);
      const [isDragging, setIsDragging] = useState(false);
      const [lastPos, setLastPos] = useState({ x: 0, y: 0 });
      const [hoveredLayer, setHoveredLayer] = useState(null);
      const [timePosition, setTimePosition] = useState(50);
      const containerRef = useRef(null);

      const handleMouseDown = (e) => {
        setIsDragging(true);
        setLastPos({ x: e.clientX, y: e.clientY });
      };

      const handleMouseMove = (e) => {
        if (!isDragging) return;
        const deltaX = e.clientX - lastPos.x;
        const deltaY = e.clientY - lastPos.y;
        setRotateY(prev => prev + deltaX * 0.5);
        setRotateX(prev => Math.max(-60, Math.min(10, prev + deltaY * 0.5)));
        setLastPos({ x: e.clientX, y: e.clientY });
      };

      const handleMouseUp = () => setIsDragging(false);

      const pestelFactors = [
        { name: 'Political', color: '#dc2626', angle: 0 },
        { name: 'Economic', color: '#d97706', angle: 60 },
        { name: 'Social', color: '#059669', angle: 120 },
        { name: 'Technological', color: '#2563eb', angle: 180 },
        { name: 'Environmental', color: '#16a34a', angle: 240 },
        { name: 'Legal', color: '#7c3aed', angle: 300 },
      ];

      const claLayers = [
        { name: 'Litany / Events', subtitle: 'What we see (Phenomenon)', depth: 0, color: '#3b82f6', description: 'Observable events, news, data - the tip of the iceberg' },
        { name: 'Systems / Structure', subtitle: 'Systemic causes', depth: 1, color: '#8b5cf6', description: 'Policies, institutions, economic systems - where system mapping reveals interconnections', hasSystemMap: true },
        { name: 'Worldview', subtitle: 'Beliefs & values', depth: 2, color: '#ec4899', description: 'Cultural assumptions, paradigms, mental models' },
        { name: 'Myth / Metaphor', subtitle: 'Deep narratives', depth: 3, color: '#f97316', description: 'Unconscious stories, archetypes, collective unconscious' },
      ];

      const layerDescriptions = {
        'pestel': 'Contextual factors shaping the system: Political, Economic, Social, Technological, Environmental, Legal.',
        ...Object.fromEntries(claLayers.map(l => [l.name, l.description]))
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100 p-4 overflow-hidden">
          {/* Header */}
          <div className="text-center mb-4">
            <h1 className="text-2xl font-bold text-slate-800 mb-1">
              Integrated Foresight Framework
            </h1>
            <p className="text-slate-500 text-sm">
              Systems Mapping + PESTEL + Causal Layered Analysis
            </p>
          </div>

          {/* Main container */}
          <div className="flex flex-col lg:flex-row gap-4 max-w-7xl mx-auto">
            {/* 3D Visualization */}
            <div
              ref={containerRef}
              className="flex-1 relative bg-white rounded-2xl border border-slate-200 shadow-lg overflow-hidden cursor-grab active:cursor-grabbing"
              style={{ height: '600px', perspective: '1200px' }}
              onMouseDown={handleMouseDown}
              onMouseMove={handleMouseMove}
              onMouseUp={handleMouseUp}
              onMouseLeave={handleMouseUp}
            >
              {/* Axes Labels */}
              <div className="absolute top-4 left-4 text-slate-500 text-xs font-mono bg-white/80 p-2 rounded-lg">
                <div className="flex items-center gap-2 mb-1">
                  <div className="w-3 h-0.5 bg-red-500"></div>
                  <span>DEPTH (Analysis Level)</span>
                </div>
                <div className="flex items-center gap-2 mb-1">
                  <div className="w-3 h-0.5 bg-green-500"></div>
                  <span>WIDTH (System Scope)</span>
                </div>
                <div className="flex items-center gap-2">
                  <div className="w-3 h-0.5 bg-blue-500"></div>
                  <span>TIME (Past ‚Üí Future)</span>
                </div>
              </div>

              {/* 3D Scene */}
              <div
                className="absolute inset-0 flex items-center justify-center"
                style={{
                  transformStyle: 'preserve-3d',
                  transform: `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`,
                  transition: isDragging ? 'none' : 'transform 0.1s ease-out'
                }}
              >
                {/* Time Axis Arrow */}
                <div
                  className="absolute"
                  style={{
                    transform: 'translateZ(-100px) translateY(250px) rotateX(90deg)',
                    transformStyle: 'preserve-3d'
                  }}
                >
                  <svg width="400" height="100" viewBox="0 0 400 100">
                    <defs>
                      <linearGradient id="timeGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" stopColor="#94a3b8" />
                        <stop offset="50%" stopColor="#2563eb" />
                        <stop offset="100%" stopColor="#3b82f6" />
                      </linearGradient>
                      <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6" />
                      </marker>
                    </defs>
                    <line x1="50" y1="50" x2="350" y2="50" stroke="url(#timeGrad)" strokeWidth="2" markerEnd="url(#arrowhead)" />
                    <text x="30" y="55" fill="#64748b" fontSize="12" fontWeight="500">PAST</text>
                    <text x="180" y="35" fill="#2563eb" fontSize="12" fontWeight="bold">PRESENT</text>
                    <text x="355" y="55" fill="#3b82f6" fontSize="12" fontWeight="500">FUTURE</text>
                  </svg>
                </div>

                {/* Depth Axis */}
                <div
                  className="absolute w-1 bg-gradient-to-b from-red-400 to-red-600"
                  style={{
                    height: '400px',
                    transform: 'translateX(-200px) translateY(100px)',
                    transformStyle: 'preserve-3d'
                  }}
                />

                {/* PESTEL Ring - Top Layer */}
                <div
                  className="absolute"
                  style={{
                    transform: 'translateY(-120px) rotateX(90deg)',
                    transformStyle: 'preserve-3d'
                  }}
                  onMouseEnter={() => setHoveredLayer('pestel')}
                  onMouseLeave={() => setHoveredLayer(null)}
                >
                  {/* Outer ring */}
                  <div
                    className="absolute rounded-full border-4"
                    style={{
                      width: '340px',
                      height: '340px',
                      left: '-170px',
                      top: '-170px',
                      borderColor: hoveredLayer === 'pestel' ? '#f59e0b' : '#cbd5e1',
                      borderStyle: 'dashed',
                      backgroundColor: hoveredLayer === 'pestel' ? 'rgba(251, 191, 36, 0.1)' : 'transparent',
                      transition: 'all 0.3s'
                    }}
                  />

                  {/* PESTEL Labels */}
                  {pestelFactors.map((factor, i) => {
                    const radius = 190;
                    const x = Math.cos((factor.angle - 90) * Math.PI / 180) * radius;
                    const y = Math.sin((factor.angle - 90) * Math.PI / 180) * radius;
                    return (
                      <div
                        key={factor.name}
                        className="absolute px-2 py-1 rounded text-xs font-bold whitespace-nowrap shadow-sm"
                        style={{
                          left: x - 40,
                          top: y - 10,
                          color: factor.color,
                          backgroundColor: 'rgba(255, 255, 255, 0.95)',
                          border: `1px solid ${factor.color}40`,
                          transform: 'rotateX(-90deg)',
                          transformStyle: 'preserve-3d'
                        }}
                      >
                        {factor.name}
                      </div>
                    );
                  })}
                </div>

                {/* CLA Iceberg Layers */}
                {claLayers.map((layer, index) => {
                  const baseWidth = 260 - (index * 50);
                  const yOffset = -80 + (index * 80);
                  const isHovered = hoveredLayer === layer.name;

                  return (
                    <div
                      key={layer.name}
                      className="absolute flex items-center justify-center"
                      style={{
                        transform: `translateY(${yOffset}px) rotateX(90deg)`,
                        transformStyle: 'preserve-3d'
                      }}
                      onMouseEnter={() => setHoveredLayer(layer.name)}
                      onMouseLeave={() => setHoveredLayer(null)}
                    >
                      {/* Layer platform */}
                      <div
                        className="rounded-lg border-2 flex items-center justify-center shadow-lg"
                        style={{
                          width: `${baseWidth}px`,
                          height: `${baseWidth * 0.6}px`,
                          marginLeft: `-${baseWidth/2}px`,
                          marginTop: `-${baseWidth * 0.3}px`,
                          backgroundColor: isHovered ? `${layer.color}30` : `${layer.color}15`,
                          borderColor: layer.color,
                          borderStyle: index === 0 ? 'solid' : 'dashed',
                          transition: 'all 0.3s'
                        }}
                      >
                        {/* System Map inside Structure layer */}
                        {layer.hasSystemMap ? (
                          <svg width={baseWidth - 40} height={(baseWidth * 0.6) - 20} viewBox="0 0 180 100">
                            {/* Nodes */}
                            {[
                              { x: 90, y: 20, size: 18 },
                              { x: 40, y: 50, size: 14 },
                              { x: 140, y: 50, size: 14 },
                              { x: 25, y: 80, size: 10 },
                              { x: 65, y: 80, size: 12 },
                              { x: 115, y: 80, size: 12 },
                              { x: 155, y: 80, size: 10 },
                            ].map((node, i) => (
                              <g key={i}>
                                <rect
                                  x={node.x - node.size/2}
                                  y={node.y - node.size/2}
                                  width={node.size}
                                  height={node.size}
                                  fill={`${layer.color}60`}
                                  stroke={layer.color}
                                  strokeWidth="1.5"
                                  rx="2"
                                />
                              </g>
                            ))}
                            {/* Connections */}
                            {[
                              [90, 20, 40, 50],
                              [90, 20, 140, 50],
                              [40, 50, 25, 80],
                              [40, 50, 65, 80],
                              [140, 50, 115, 80],
                              [140, 50, 155, 80],
                              [40, 50, 140, 50],
                            ].map((line, i) => (
                              <line
                                key={i}
                                x1={line[0]} y1={line[1]}
                                x2={line[2]} y2={line[3]}
                                stroke={layer.color}
                                strokeWidth="1.5"
                                strokeOpacity="0.7"
                              />
                            ))}
                            {/* Label */}
                            <text x="90" y="95" textAnchor="middle" fill={layer.color} fontSize="8" fontWeight="bold" opacity="0.8">
                              SYSTEMS MAP
                            </text>
                          </svg>
                        ) : (
                          <span
                            className="font-semibold text-sm"
                            style={{
                              color: layer.color,
                              transform: 'rotateX(-90deg)'
                            }}
                          >
                            {layer.name}
                          </span>
                        )}
                      </div>

                      {/* Side label */}
                      <div
                        className="absolute text-xs whitespace-nowrap font-medium"
                        style={{
                          left: `${baseWidth/2 + 20}px`,
                          top: '0px',
                          color: layer.color,
                          transform: 'rotateX(-90deg)'
                        }}
                      >
                        {layer.subtitle}
                      </div>

                      {/* Layer name for system map layer */}
                      {layer.hasSystemMap && (
                        <div
                          className="absolute text-sm font-bold whitespace-nowrap"
                          style={{
                            left: `-${baseWidth/2 + 80}px`,
                            top: '0px',
                            color: layer.color,
                            transform: 'rotateX(-90deg)'
                          }}
                        >
                          {layer.name}
                        </div>
                      )}
                    </div>
                  );
                })}

                {/* Connecting funnel lines */}
                <svg
                  className="absolute"
                  width="300"
                  height="350"
                  style={{
                    transform: 'translateX(-150px) translateY(-50px)',
                    pointerEvents: 'none'
                  }}
                >
                  <defs>
                    <linearGradient id="funnelGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                      <stop offset="0%" stopColor="#3b82f6" stopOpacity="0.4" />
                      <stop offset="100%" stopColor="#f97316" stopOpacity="0.4" />
                    </linearGradient>
                  </defs>
                  {/* Left edge */}
                  <path
                    d="M 20 0 Q 50 175 120 350"
                    stroke="url(#funnelGrad)"
                    strokeWidth="2"
                    fill="none"
                    strokeDasharray="5,5"
                  />
                  {/* Right edge */}
                  <path
                    d="M 280 0 Q 250 175 180 350"
                    stroke="url(#funnelGrad)"
                    strokeWidth="2"
                    fill="none"
                    strokeDasharray="5,5"
                  />
                </svg>

                {/* Person at bottom with Hope/Fear */}
                <div
                  className="absolute"
                  style={{
                    transform: 'translateY(280px)',
                    transformStyle: 'preserve-3d'
                  }}
                >
                  <svg width="120" height="100" viewBox="0 0 120 100">
                    {/* Stick figure */}
                    <circle cx="60" cy="20" r="12" fill="none" stroke="#64748b" strokeWidth="2" />
                    <line x1="60" y1="32" x2="60" y2="60" stroke="#64748b" strokeWidth="2" />
                    <line x1="60" y1="40" x2="40" y2="55" stroke="#64748b" strokeWidth="2" />
                    <line x1="60" y1="40" x2="80" y2="55" stroke="#64748b" strokeWidth="2" />
                    <line x1="60" y1="60" x2="45" y2="85" stroke="#64748b" strokeWidth="2" />
                    <line x1="60" y1="60" x2="75" y2="85" stroke="#64748b" strokeWidth="2" />

                    {/* Hope bubble */}
                    <ellipse cx="30" cy="10" rx="18" ry="12" fill="rgba(34, 197, 94, 0.2)" stroke="#16a34a" strokeWidth="1.5" />
                    <text x="30" y="14" textAnchor="middle" fill="#16a34a" fontSize="8" fontWeight="bold">HOPE</text>

                    {/* Fear bubble */}
                    <ellipse cx="90" cy="10" rx="18" ry="12" fill="rgba(239, 68, 68, 0.2)" stroke="#dc2626" strokeWidth="1.5" />
                    <text x="90" y="14" textAnchor="middle" fill="#dc2626" fontSize="8" fontWeight="bold">FEAR</text>
                  </svg>
                </div>
              </div>

              {/* Drag instruction */}
              <div className="absolute bottom-4 left-1/2 -translate-x-1/2 text-slate-400 text-xs bg-white/80 px-3 py-1 rounded-full">
                üñ±Ô∏è Drag to rotate
              </div>
            </div>

            {/* Info Panel */}
            <div className="w-full lg:w-80 space-y-4">
              {/* Layer Info */}
              <div className="bg-white rounded-xl border border-slate-200 shadow-sm p-4">
                <h3 className="text-slate-800 font-semibold mb-3 flex items-center gap-2">
                  <span className="w-2 h-2 rounded-full bg-blue-500"></span>
                  {hoveredLayer ? hoveredLayer : 'Hover a Layer'}
                </h3>
                <p className="text-slate-600 text-sm">
                  {hoveredLayer ? layerDescriptions[hoveredLayer] : 'Hover over different layers to see descriptions'}
                </p>
              </div>

              {/* Time Slider */}
              <div className="bg-white rounded-xl border border-slate-200 shadow-sm p-4">
                <h3 className="text-slate-800 font-semibold mb-3">Time Dimension</h3>
                <input
                  type="range"
                  min="0"
                  max="100"
                  value={timePosition}
                  onChange={(e) => setTimePosition(parseInt(e.target.value))}
                  className="w-full accent-blue-500"
                />
                <div className="flex justify-between text-xs text-slate-500 mt-1">
                  <span>Past</span>
                  <span className="text-blue-600 font-medium">Present</span>
                  <span>Future</span>
                </div>
              </div>

              {/* Legend */}
              <div className="bg-white rounded-xl border border-slate-200 shadow-sm p-4">
                <h3 className="text-slate-800 font-semibold mb-3">CLA Layers</h3>
                <div className="space-y-2">
                  {claLayers.map((layer) => (
                    <div
                      key={layer.name}
                      className="flex items-center gap-2 text-sm cursor-pointer hover:bg-slate-50 p-1.5 rounded transition-colors"
                      onMouseEnter={() => setHoveredLayer(layer.name)}
                      onMouseLeave={() => setHoveredLayer(null)}
                    >
                      <div
                        className="w-3 h-3 rounded"
                        style={{ backgroundColor: layer.color }}
                      />
                      <span className="text-slate-700">{layer.name}</span>
                      {layer.hasSystemMap && (
                        <span className="text-xs text-slate-400 ml-auto">+ Systems Map</span>
                      )}
                    </div>
                  ))}
                </div>
              </div>

              {/* PESTEL */}
              <div className="bg-white rounded-xl border border-slate-200 shadow-sm p-4">
                <h3 className="text-slate-800 font-semibold mb-3">PESTEL Context</h3>
                <div className="flex flex-wrap gap-2">
                  {pestelFactors.map((factor) => (
                    <span
                      key={factor.name}
                      className="px-2 py-1 rounded text-xs font-medium"
                      style={{
                        backgroundColor: `${factor.color}15`,
                        color: factor.color,
                        border: `1px solid ${factor.color}30`
                      }}
                    >
                      {factor.name}
                    </span>
                  ))}
                </div>
              </div>

              {/* Framework explanation */}
              <div className="bg-white rounded-xl border border-slate-200 shadow-sm p-4">
                <h3 className="text-slate-800 font-semibold mb-2">About This Framework</h3>
                <p className="text-slate-600 text-xs leading-relaxed">
                  This integrated model combines <span className="text-purple-600 font-medium">Systems Mapping</span> at the structural level,
                  <span className="text-amber-600 font-medium"> PESTEL</span> contextual factors, and
                  <span className="text-blue-600 font-medium"> Causal Layered Analysis</span> depth
                  across a <span className="text-blue-600 font-medium">time dimension</span> for comprehensive foresight analysis.
                </p>
              </div>
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<SystemsCLADiagram />);
  </script>
</body>
</html>
